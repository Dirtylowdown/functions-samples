<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>title</title>
  </head>
  <body>
    <button id="btn-call-func">Call function</button>
    <p id="p-result"></p>
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-app.js";
      import {
        getFunctions,
        httpsCallable,
        connectFunctionsEmulator,
      } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-functions.js";

      const callableButton = document.getElementById("btn-call-func");
      const resultElement = document.getElementById("p-result");

      callableButton.onclick = handleClick;

      // set your firebase config object
      const firebaseConfig = undefined;
      if (!firebaseConfig) {
        throw new Error('You must set your Firebase config');
      }
      const app = initializeApp(firebaseConfig);
      const functions = getFunctions(app);
      connectFunctionsEmulator(functions, "127.0.0.1", 5001);
      const streamResponse = httpsCallable(functions, "streamResponse");

      async function handleClick() {
        // reset result
        clearOutput();

        const resp = await streamResponse.stream({
          text: "What is your favorite Firebase service and why?",
        });

        // add each new chunk to the output
        for await (const chunk of resp.stream) {
          appendToOutput(chunk);
        }
      };

      function clearOutput() {
        resultElement.innerHTML = "";
      }

      function appendToOutput(str) {
        resultElement.innerHTML += str;
      }
    </script>
  </body>
</html>
